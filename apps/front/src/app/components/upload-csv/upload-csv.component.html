<div class="min-h-screen bg-gray-50">
  <!-- Layout Principal -->
  <div class="flex">
    <!-- Sidebar -->
    <app-sidebar></app-sidebar>

    <!-- Conteúdo Principal -->
    <main class="flex-1 p-4">
      <!-- Loading State Moderno -->
      <ng-container *ngIf="carregandoPagina; else uploadContent">
        <div class="flex flex-col items-center justify-center py-16">
          <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"></div>
          <h3 class="mt-6 text-lg font-semibold text-gray-900">
            Carregando Formulários
          </h3>
          <p class="text-gray-500 mt-2">
            Aguarde enquanto preparamos suas informações...
          </p>
        </div>
      </ng-container>

      <ng-template #uploadContent>
        <!-- Boas-vindas e Resumo -->
        <div class="mb-6">
          <h1 class="text-xl font-bold text-gray-900 mb-1">
            Upload de Formulários CSV
          </h1>
          <p class="text-gray-600">
            Faça upload de um arquivo CSV para criar formulários com campos estruturados
          </p>
        </div>

        <!-- Navegação por abas -->
        <div
          class="bg-white rounded-xl border border-gray-200 p-4 hover:border-gray-300 transition-colors duration-200 mb-6">
          <!-- Barra de busca - posicionada acima das abas -->
          <div *ngIf="activeTab === 'list' && templates.length > 0" class="p-4 border-b border-gray-200 mb-4">
            <div class="max-w-md mx-auto">
              <div class="relative">
                <input type="text" [(ngModel)]="searchTerm" (input)="onSearchChange()"
                  placeholder="Buscar Formulários..."
                  class="w-full px-4 py-3 pl-12 border border-gray-300 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all duration-200 text-gray-900 placeholder-gray-500">
                <mat-icon class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">search</mat-icon>
              </div>
            </div>
          </div>

          <!-- Abas -->
          <div class="flex border-b border-gray-200">
            <button (click)="activeTab = 'upload'"
              [class]="activeTab === 'upload' ? 'px-6 py-4 text-indigo-600 border-b-2 border-indigo-500 font-semibold' : 'px-6 py-4 text-gray-500 hover:text-gray-700 font-medium'"
              class="transition-colors duration-200">
              Importar CSV
            </button>
            <button (click)="activeTab = 'list'"
              [class]="activeTab === 'list' ? 'px-6 py-4 text-indigo-600 border-b-2 border-indigo-500 font-semibold' : 'px-6 py-4 text-gray-500 hover:text-gray-700 font-medium'"
              class="transition-colors duration-200">
              Meus Formulários
            </button>
          </div>

          <!-- Conteúdo da aba Upload -->
          <div *ngIf="activeTab === 'upload'" class="p-6">
            <div class="text-center">
              <!-- Área de upload -->
              <div id="csv-upload-area"
                class="w-full max-w-2xl mx-auto p-12 border-2 border-dashed rounded-2xl cursor-pointer transition-all duration-200 hover:border-indigo-400 hover:bg-indigo-50"
                [class]="selectedFile ? 'border-green-400 bg-green-50' : 'border-gray-300'"
                [class.bg-indigo-50]="isDragOver" (click)="fileInput.click()" (dragover)="onDragOver($event)"
                (dragleave)="onDragLeave($event)" (drop)="onDrop($event)" role="button" tabindex="0"
                (keydown.enter)="fileInput.click()" (keydown.space)="fileInput.click()"
                aria-label="Área para upload de arquivo CSV">
                <input #fileInput type="file" accept=".csv,.xlsx,.xls" (change)="onFileSelected($event)" class="hidden"
                  aria-describedby="uploadHelp" />

                <div *ngIf="!selectedFile" class="text-center">
                  <div class="w-20 h-20 bg-indigo-100 rounded-xl flex items-center justify-center mx-auto mb-6">
                    <mat-icon class="text-indigo-600 text-4xl">cloud_upload</mat-icon>
                  </div>
                  <h3 class="text-xl font-semibold text-gray-800 mb-2">
                    Clique ou arraste um arquivo CSV ou Excel
                  </h3>
                  <p class="text-gray-500">
                    Formatos aceitos: .csv, .xlsx, .xls
                  </p>
                </div>

                <div *ngIf="selectedFile" class="text-center">
                  <div class="w-20 h-20 bg-green-100 rounded-xl flex items-center justify-center mx-auto mb-6">
                    <mat-icon class="text-green-600 text-4xl">cloud_done</mat-icon>
                  </div>
                  <h3 class="text-xl font-semibold text-gray-800 mb-2">
                    {{ selectedFile.name }}
                  </h3>
                  <p class="text-gray-500">
                    {{ (selectedFile.size / 1024).toFixed(1) }} KB
                  </p>
                </div>
              </div>

              <div id="uploadHelp" class="text-sm text-gray-500 mt-3">
                Clique na área acima ou arraste um arquivo CSV para criar formulários
              </div>

              <!-- Botões de ação -->
              <div class="mt-8 flex gap-4 justify-center">
                <app-loading-button id="csv-upload-button" [loading]="carregando" [disabled]="!selectedFile"
                  text="Enviar CSV" loadingText="Enviando..." icon="cloud_upload" ariaLabel="Enviar arquivo CSV"
                  ariaDescribedBy="uploadButtonHelp" (onClick)="uploadArquivo()"></app-loading-button>

                <button *ngIf="selectedFile" (click)="limparArquivo()"
                  class="px-6 py-3 text-red-600 border border-red-300 rounded-xl bg-white hover:bg-red-50 hover:border-red-400 transition-all duration-200 font-semibold flex items-center gap-2">
                  <mat-icon>clear</mat-icon>
                  Limpar
                </button>
              </div>

              <div id="uploadButtonHelp" class="text-sm text-gray-500 mt-2">
                {{ selectedFile ? 'Clique para criar formulários do arquivo' :
                'Selecione um arquivo CSV primeiro' }}
              </div>

              <!-- Download de exemplo -->
              <div class="mt-6">
                <button (click)="downloadExemplo()"
                  class="px-4 py-2 text-indigo-600 border border-indigo-300 rounded-lg bg-white hover:bg-indigo-50 hover:border-indigo-400 transition-all duration-200 font-medium flex items-center gap-2 mx-auto">
                  <mat-icon>download</mat-icon>
                  Baixar Exemplo CSV
                </button>
              </div>

              <!-- Informações sobre o formato -->
              <div class="mt-6 p-4 bg-gray-50 rounded-xl border border-gray-200">
                <h6 class="text-sm font-semibold text-gray-800 mb-3">Formato do CSV:</h6>
                <div class="space-y-2 text-sm text-gray-600">
                  <p>
                    <strong>Colunas obrigatórias:</strong> NomeTemplate, DescricaoTemplate
                  </p>
                  <p>
                    <strong>Campos opcionais:</strong> Campo1, Valor1, Tipo1, Campo2, Valor2, Tipo2...
                  </p>
                  <p>
                    <strong>Tipos suportados:</strong> text, email, password, number, tel, url
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Conteúdo da aba Listagem -->
          <div *ngIf="activeTab === 'list'" class="p-6">
            <!-- Loading state -->
            <ng-container *ngIf="carregando; else templatesContent">
              <div class="text-center py-8">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"></div>
                <p class="text-gray-600">Carregando forulários...</p>
              </div>
            </ng-container>

            <ng-template #templatesContent>
              <!-- Lista de templates -->
              <ng-container *ngIf="templates.length > 0; else noTemplates">
                <div class="overflow-hidden rounded-xl border border-gray-200">
                  <table class="w-full">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Nome do Formulário</th>
                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Descrição</th>
                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Campos</th>
                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Ações</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                      <tr *ngFor="let template of paginatedTemplates"
                        class="hover:bg-gray-50 transition-colors duration-200">
                        <td class="px-6 py-4 text-sm text-gray-900">{{ template.nome }}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">{{ template.descricao || '-' }}</td>
                        <td class="px-6 py-4">
                          <span
                            class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                            {{ template.campos.length || 0 }}
                          </span>
                        </td>
                        <td class="px-6 py-4">
                          <button (click)="deletarTemplate(template)"
                            class="p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-lg transition-colors duration-200"
                            matTooltip="Deletar template">
                            <mat-icon>delete</mat-icon>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Paginação -->
                <div class="mt-6 flex items-center justify-between">
                  <div class="flex items-center gap-2">
                    <span class="text-sm text-gray-700">Mostrar</span>
                    <select [(ngModel)]="pageSize" (change)="onPageSizeChange()"
                      class="px-3 py-2 border border-gray-300 rounded-lg bg-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500">
                      <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
                    </select>
                    <span class="text-sm text-gray-700">de {{ filteredTemplates.length }} formulários</span>
                  </div>

                  <div class="flex items-center gap-2">
                    <button (click)="previousPage()" [disabled]="currentPage === 1"
                      class="px-3 py-2 text-gray-500 border border-gray-300 rounded-lg bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200">
                      <mat-icon>chevron_left</mat-icon>
                    </button>

                    <span class="px-3 py-2 text-sm text-gray-700">
                      Página {{ currentPage }} de {{ getTotalPages() }}
                    </span>

                    <button (click)="nextPage()" [disabled]="currentPage >= getTotalPages()"
                      class="px-3 py-2 text-gray-500 border border-gray-300 rounded-lg bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200">
                      <mat-icon>chevron_right</mat-icon>
                    </button>
                  </div>
                </div>
              </ng-container>

              <!-- Estado vazio -->
              <ng-template #noTemplates>
                <div class="text-center py-12">
                  <div class="w-20 h-20 bg-gray-100 rounded-xl flex items-center justify-center mx-auto mb-6">
                    <mat-icon class="text-gray-400 text-4xl">article</mat-icon>
                  </div>
                  <h4 class="text-xl font-semibold text-gray-700 mb-3">Nenhum formulário encontrado</h4>
                  <p class="text-gray-500">
                    Faça upload de um arquivo CSV para criar seus primeiros formulários
                  </p>
                </div>
              </ng-template>
            </ng-template>
          </div>
        </div>
      </ng-template>
    </main>
  </div>
</div>

<app-footer></app-footer>